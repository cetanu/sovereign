resources:
{% for instance in instances %}
  - '@type': type.googleapis.com/envoy.api.v2.Cluster
    name: {{ instance['name'] }}
    type: STRICT_DNS
    connect_timeout: 5s
    transport_socket:
      - name: "envoy.transport_sockets.tls"
        typed_config: {}
    load_assignment:
      cluster_name: {{ instance['name'] + "_cluster" }}
      endpoints:
        {% for endpoint in instance['endpoints'] %}
        - locality:
              zone: {{ endpoint['region'] }}
            lb_endpoints:
              - endpoint:
                  address:
                    socket_address:
                      address: {{ endpoint['address'] }}
                      port_value: {{ endpoint['port'] }}
        {% endfor %}
{% endfor %}
